.PHONY: build install clean deps test lint

BINARY_NAME=k8s-cloud
VERSION?=2.0.0
COMMIT?=$(shell git rev-parse --short HEAD 2>/dev/null || echo "dev")
LDFLAGS=-ldflags "-X main.version=${VERSION} -X main.commit=${COMMIT}"

build:
	@echo "ğŸ”¨ Building ${BINARY_NAME} v${VERSION}..."
	@go build ${LDFLAGS} -o ${BINARY_NAME} .
	@echo "âœ… Build complete: ${BINARY_NAME}"

install: build
	@echo "ğŸ“¦ Installing ${BINARY_NAME}..."
	@mkdir -p ~/.local/bin
	@cp ${BINARY_NAME} ~/.local/bin/
	@echo "âœ… Installed to ~/.local/bin/${BINARY_NAME}"
	@echo "ğŸ’¡ Make sure ~/.local/bin is in your PATH"

clean:
	@echo "ğŸ§¹ Cleaning..."
	@rm -f ${BINARY_NAME}
	@rm -rf .pulumi/
	@echo "âœ… Clean complete"

deps:
	@echo "ğŸ“¥ Downloading dependencies..."
	@go mod download
	@go mod tidy
	@echo "âœ… Dependencies ready"

test:
	@echo "ğŸ§ª Running tests..."
	@go test -v ./...

lint:
	@echo "ğŸ” Running linter..."
	@golangci-lint run || echo "âš ï¸  Install golangci-lint: brew install golangci-lint"

.DEFAULT_GOAL := build